<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–æ—Å—Ç—ã</title>
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ jQuery QRCode -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>
  <script type="module">


    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, get, onValue, set, update  } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import { push } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAhJwmFlIgXt0z6gcoErRTXQo3kkjDqOuo",
      authDomain: "lastp-44a37.firebaseapp.com",
      databaseURL: "https://lastp-44a37-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "lastp-44a37",
      storageBucket: "lastp-44a37.appspot.com",
      messagingSenderId: "972643290372",
      appId: "1:972643290372:web:c42fdc293cf8cac0609451",
      measurementId: "G-C7R84JG5XZ"
    };





    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const storage = getStorage(app);
    const auth = getAuth(app);

    const postsContainer = document.getElementById('postsContainer');
    const titleFilterInput = document.getElementById('titleFilter');
    const dateFilterInput = document.getElementById('dateFilter');
    const keywordsFilterInput = document.getElementById('keywordsFilter');

    const loginButton = document.getElementById('loginButton');
    const loginModal = document.getElementById('loginModal');
    const closeModal = document.getElementById('closeModal');
    const submitLogin = document.getElementById('submitLogin');

    const createPostButton = document.getElementById('createPostButton');
    const createPostModal = document.getElementById('createPostModal');
    const closeCreatePostModal = document.getElementById('closeCreatePostModal');
    const submitPostButton = document.getElementById('submitPostButton');

    createPostButton.onclick = function() {
      createPostModal.style.display = "block";
      loadEventsForSelect(); // –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    }

    closeCreatePostModal.onclick = function() {
      createPostModal.style.display = "none";
    }

    window.onclick = function(event) {
      if (event.target === createPostModal) {
        createPostModal.style.display = "none";
      }
      if (event.target === loginModal) {
        loginModal.style.display = "none";
      }
    }


    document.getElementById('openMarkersButton').onclick = function() {
      document.getElementById('markersModal').style.display = 'block';
      load(); // Load markers when the modal is opened
    }

    document.getElementById('closeMarkersModal').onclick = function() {
      document.getElementById('markersModal').style.display = 'none';
    }

    // Close modal when clicking outside of it
    window.onclick = function(event) {
      if (event.target === document.getElementById('markersModal')) {
        document.getElementById('markersModal').style.display = 'none';
      }
    }

    // Function to load markers from Firebase
    function load() {
      const userEmail = auth.currentUser .email; // Get current user's email
      const manipulatedEmail = userEmail.replace(".", ",").replace("@", "_").replace(".", ",");

      const markersRef = ref(database, `addresses/${manipulatedEmail}/zapisi`); // Path to markers in the database
      get(markersRef).then((snapshot) => {
        const markersList = document.getElementById('markersList');
        markersList.innerHTML = ''; // Clear previous markers

        if (snapshot.exists()) {
          snapshot.forEach((childSnapshot) => {
            const markerId = childSnapshot.val(); // Get marker ID
            fetchMarkerDetails(markerId, markersList); // Fetch details for each marker
          });
        } else {
          markersList.innerHTML = '<li>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Ç–æ–∫.</li>';
        }
      }).catch((error) => {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–µ—Ç–æ–∫:", error);
      });
    }

    // Function to fetch marker details and display them
    function fetchMarkerDetails(markerId, markersList) {
      const markerRef = ref(database, `banners/${markerId}`);
      get(markerRef).then((snapshot) => {
        if (snapshot.exists()) {
          const markerData = snapshot.val();
          const listItem = document.createElement('li');
          listItem.textContent = `–¢–µ–º–∞: ${markerData.theme}, –î–∞—Ç–∞: ${markerData.date}`;
          markersList.appendChild(listItem);
        }
      }).catch((error) => {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ—Ç–∫–∏:", error);
      });
    }



    function openEvent(bannerId) {
      const eventRef = ref(database, 'banners/' + bannerId);
      get(eventRef).then((snapshot) => {
        if (snapshot.exists()) {
          const eventData = snapshot.val();
          document.getElementById('eventTheme').innerText = eventData.theme;
          document.getElementById('eventDescription').innerText = eventData.description;
          document.getElementById('eventMetka').innerText = eventData.metka;
          document.getElementById('eventImage').src = eventData.imageUrl;

          // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞
          const appLink = "https://logo-2-0.vercel.app/index.html?bannerId=" + bannerId; // –°—Å—ã–ª–∫–∞ –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–∞
          generateQRCode(appLink); // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥

          // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
          document.getElementById('eventDetailsModal').style.display = "block";
        } else {
          alert("–î–∞–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.");
        }
      }).catch((error) => {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:", error);
      });
    }



    submitPostButton.onclick = function() {
      const title = document.getElementById('postTitle').value;
      const content = document.getElementById('postContent').value;
      const imageInput = document.getElementById('postImage');
      const imageFile = imageInput.files[0];
      const eventId = document.getElementById('eventSelect').value; // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ

      if (!title || !content || !imageFile || !eventId) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.");
        return;
      }

      uploadPost(title, content, imageFile, eventId); // –ü–µ—Ä–µ–¥–∞–µ–º eventId
    }

    function uploadPost(title, content, imageFile, eventId) {
      if (!auth.currentUser ) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç.");
        return;
      }

      const progressDialog = document.createElement('div');
      progressDialog.innerText = "–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–∞...";
      document.body.appendChild(progressDialog);

      const storageReference = storageRef(storage, 'uploads/' + imageFile.name);
      const uploadTask = uploadBytes(storageReference, imageFile);

      uploadTask.then((snapshot) => {
        console.log('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ:', snapshot);
        return getDownloadURL(snapshot.ref);
      }). then((downloadURL) => {
        const postId = Date.now().toString(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É –∫–∞–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
        const authorId = auth.currentUser .uid; // –ü–æ–ª—É—á–∞–µ–º ID –∞–≤—Ç–æ—Ä–∞
        const post = {
          id: postId,
          authorId: authorId,
          title: title,
          content: content,
          imageUrl: downloadURL,
          date: new Date().toISOString(),
          keywords: [],
          likes: 0, // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–∞–π–∫–∏
          comments: {}, // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
          rulseId: eventId // –î–æ–±–∞–≤–ª—è–µ–º ID –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
        };

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å—Ç–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        set(ref(database, 'posts/' + postId), post)
          .then(() => {
            progressDialog.innerText = "–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!";
            setTimeout(() => {
              progressDialog.remove();
              createPostModal.style.display = "none"; // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
              document.getElementById('postTitle').value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
              document.getElementById('postContent').value = '';
              imageInput.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
              loadPosts(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤
            }, 2000); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
          })
          .catch((error) => {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ—Å—Ç–∞:", error);
            progressDialog.innerText = "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ—Å—Ç–∞.";
          });
      }).catch((error) => {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error);
        progressDialog.innerText = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏.";
      });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
    function loadEventsForSelect() {
      const eventsRef = ref(database, 'banners');
      get(eventsRef).then((snapshot) => {
        const eventSelect = document.getElementById('eventSelect');
        eventSelect.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤

        if (snapshot.exists()) {
          snapshot.forEach((childSnapshot) => {
            const event = childSnapshot.val();
            const option = document.createElement('option');
            option.value = event.id; // –ò—Å–ø–æ–ª—å–∑—É–µ–º ID –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
            option.textContent = event.theme; // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–µ–º—É –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
            eventSelect.appendChild(option);
          });
        } else {
          const option = document.createElement('option');
          option.textContent = '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π';
          eventSelect.appendChild(option);
        }
      }).catch((error) => {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π:", error);
      });
    }









    loginButton.onclick = function() {
      loginModal.style.display = "block";
    }

    closeModal.onclick = function() {
      loginModal.style.display = "none";
    }

    submitLogin.onclick = function() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      loginUser (email, password);
    }

    function loginUser (email, password) {
      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
          alert("–í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏!");
          loginModal.style.display = "none";
          loginButton.innerText = "–í–æ—à–µ–ª"; // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
        })
        .catch((error) => {
          // –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞
          alert("–û—à–∏–±–∫–∞: " + error.message);
        });
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤ –∏–∑ Firebase
    function loadPosts() {
      const postsRef = ref(database, 'posts');
      get(postsRef).then((snapshot) => {
        if (snapshot.exists()) {
          postsContainer.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
          const posts = snapshot.val();
          for (const key in posts) {
            if (posts.hasOwnProperty(key)) {
              addPostToView(posts[key]);
            }
          }
        } else {
          postsContainer.innerHTML = '–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
        }
      }).catch((error) => {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ", error);
      });
    }


    function addPostToView(post) {
      const postDiv = document.createElement('div');
      postDiv.classList.add('post');
      postDiv.innerHTML = `
        <h3>${post.title || '–ë–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞'}</h3>
        <p>${post.content || '–ë–µ–∑ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è'}</p>
        <img src="${post.imageUrl || ''}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–∞" style="max-width: 100%; height: auto;">
        <p><strong>–î–∞—Ç–∞:</strong> ${post.date || '–ù–µ—Ç –¥–∞—Ç—ã'}</p>
        <p><strong>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</strong> ${Array.isArray(post.keywords) && post.keywords.length > 0 ? post.keywords.join(', ') : '–ù–µ—Ç –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤'}</p>
        <p><strong>–õ–∞–π–∫–∏:</strong> <span id="likes-${post.id}">${post.likes || 0}</span> <button id="likeButton-${post.id}">üëç</button></p>
        <p><strong>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ:</strong> ${post.rulseId ? `<button id="eventButton-${post.id}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>` : '–ù–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ'}</p>
        <h4>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</h4>
        <div id="comments-${post.id}"></div>
        <input type="text" id="commentInput-${post.id}" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
        <button id="addCommentButton-${post.id}">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
    `;
      postsContainer.appendChild(postDiv);

      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
      document.getElementById(`likeButton-${post.id}`).onclick = () => likePost(post);
      document.getElementById(`addCommentButton-${post.id}`).onclick = () => addComment(post.id);

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ"
      if (post.rulseId) {
        document.getElementById(`eventButton-${post.id}`).onclick = () => {
          openEventDetails(post.rulseId); // –ü–µ—Ä–µ–¥–∞–µ–º rulseId –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞
        };
      }
      loadComments(post.id);
    }

    function signUpForEvent(eventId) {
      if (!auth.currentUser ) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ.");
        return;
      }

      const userEmail = auth.currentUser .email; // –ü–æ–ª—É—á–∞–µ–º email —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const manipulatedEmail = userEmail.replace(".", ",").replace("@", "_").replace(".", ",");

      const signUpsRef = ref(database, `banners/${eventId}/users`); // –ü—É—Ç—å –∫ —É–∑–ª—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø–∏—Å–∞–Ω –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
      get(signUpsRef).then((snapshot) => {
        let users = {};

        if (snapshot.exists()) {
          users = snapshot.val();
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø–∏—Å–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ email
          if (users[manipulatedEmail]) {
            alert("–í—ã —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ —ç—Ç–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ.");
            return;
          }
        }

        const userRef = ref(database, `banners/${eventId}/users/${manipulatedEmail}`);

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–±—Ä–∞—Ç–Ω–æ –≤ —É–∑–µ–ª users
        set(userRef, manipulatedEmail)
          .then(() => {
            // –ó–∞–ø–∏—Å—å –≤ –∞–¥—Ä–µ—Å–∞
            const goWindow = manipulatedEmail; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π email –∫–∞–∫ –∫–ª—é—á
            const addressesRef = ref(database, `addresses/${goWindow}/zapisi/${eventId}`);
            return set(addressesRef, eventId); // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º ID –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
          })
          .then(() => {
            alert("–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ!");
          })
          .catch((error) => {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ:", error);
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑: " + error.message);
          });
      }).catch((error) => {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∑–∞–ø–∏—Å–µ–π:", error);
      });
    }

    // –ò–∑–º–µ–Ω–∏—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"
    document.getElementById('signUpButton').onclick = function() {
      const eventId = document.getElementById('eventImage').getAttribute('data-event-id'); // –ü–æ–ª—É—á–∞–µ–º ID –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
      signUpForEvent(eventId);
    };

    // –í —Ñ—É–Ω–∫—Ü–∏–∏ openEventDetails –¥–æ–±–∞–≤—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É data-event-id –¥–ª—è –∫–Ω–æ–ø–∫–∏
    function openEventDetails(rulseId) {
      const eventRef = ref(database, 'banners/' + rulseId);
      get(eventRef).then((snapshot) => {
        if (snapshot.exists()) {
          const eventData = snapshot.val();
          document.getElementById('eventTheme').innerText = eventData.theme;
          document.getElementById('eventDescription').innerText = eventData.description;
          document.getElementById('eventMetka').innerText = eventData.metka;
          document.getElementById('eventImage').src = eventData.imageUrl;
          document.getElementById('eventImage').setAttribute('data-event-id', rulseId); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º ID –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è

          // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞
          const bannerId = rulseId; // –ò—Å–ø–æ–ª—å–∑—É–µ–º rulseId –∫–∞–∫ bannerId
          const appLink = "https://banner?bannerId=" + bannerId; // –°—Å—ã–ª–∫–∞ –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–∞
          const webLink = "https://logo-2-0.vercel.app/index.html?bannerId=" + bannerId; // –°—Å—ã–ª–∫–∞ –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–∞
          const finalLink = appLink + "||" + webLink; // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å—Å—ã–ª–∫–∏
          generateQRCode(finalLink); // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥

          // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–ª–∏–∫–∞ –Ω–∞ QR-–∫–æ–¥
          $('#qrcode').off('click').on('click', function() {
            const links = finalLink.split('||');
            const appLink = links[0];
            const webLink = links[1];

            // –ü–æ–ø—Ä–æ–±—É–µ–º –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            window.location.href = appLink;

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –≤–µ–±-—Å–∞–π—Ç —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(() => {
              window.location.href = webLink; // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤–µ–±-—Å–∞–π—Ç
            }, 1000); // –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ 1 —Å–µ–∫—É–Ω–¥—É
          });

          // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
          document.getElementById('eventDetailsModal').style.display = "block";
        } else {
          alert("–î–∞–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.");
        }
      }).catch((error) => {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:", error);
      });
    }

    function generateQRCode(link) {
      $('#qrcode').empty(); // –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π QR-–∫–æ–¥
      $('#qrcode').qrcode({
        text: link,
        width: 200,
        height: 200,
      });
    }


    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    document.getElementById('closeEventDetailsModal').onclick = function() {
      document.getElementById('eventDetailsModal').style.display = "none";
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    window.onclick = function(event) {
      if (event.target === document.getElementById('eventDetailsModal')) {
        document.getElementById('eventDetailsModal').style.display = "none";
      }
    }

    function likePost(post) {
      const userId = auth.currentUser .uid; // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      if (!post.likedBy) {
        post.likedBy = []; // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤, –µ—Å–ª–∏ –æ–Ω –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
      }

      if (!post.likedBy.includes(userId)) {
        post.likedBy.push(userId); // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –º–∞—Å—Å–∏–≤ –ª–∞–π–∫–æ–≤
        post.likes++; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        set(ref(database, `posts/${post.id}`), post)
          .then(() => {
            document.getElementById(`likes-${post.id}`).innerText = post.likes; // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–∞–π–∫–æ–≤
            alert("–ü–æ—Å—Ç –ª–∞–π–∫–Ω—É—Ç!");
          })
          .catch((error) => {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ—Å—Ç–∞:", error);
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ª–∞–π–∫–Ω—É—Ç—å –ø–æ—Å—Ç.");
          });
      } else {
        alert("–í—ã —É–∂–µ –ª–∞–π–∫–Ω—É–ª–∏ —ç—Ç–æ—Ç –ø–æ—Å—Ç.");
      }
    }

    function addComment(postId) {
      const commentInput = document.getElementById(`commentInput-${postId}`);
      const commentText = commentInput.value.trim();

      if (!auth.currentUser ) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.");
        return;
      }

      if (!commentText) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.");
        return;
      }

      const commentsRef = ref(database, `posts/${postId}/comments`);

      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –Ω–æ–º–µ—Ä
      get(commentsRef).then((snapshot) => {
        let nextCommentNumber = 1; // –ù–∞—á–∏–Ω–∞–µ–º —Å 1

        if (snapshot.exists()) {
          const comments = snapshot.val();
          // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
          nextCommentNumber = Math.max(...Object.keys(comments).map(Number)) + 1;
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –Ω–æ–º–µ—Ä–æ–º
        const commentId = nextCommentNumber.toString();
        const newCommentRef = ref(database, `posts/${postId}/comments/${commentId}`);

        set(newCommentRef, commentText)
          .then(() => {
            commentInput.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            loadComments(postId); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
            alert("–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω!");
          })
          .catch((error) => {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:", error);
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
          });
      }).catch((error) => {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:", error);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.");
      });
    }

    function loadComments(postId) {
      const commentsRef = ref(database, `posts/${postId}/comments`);

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
      onValue(commentsRef, (snapshot) => {
        const commentsDiv = document.getElementById(`comments-${postId}`);
        commentsDiv.innerHTML = ''; // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

        if (snapshot.exists()) {
          const comments = snapshot.val();
          for (const commentId in comments) {
            if (comments.hasOwnProperty(commentId)) {
              const commentText = comments[commentId];
              const commentElement = document.createElement('p');
              commentElement.innerText = `${commentId}: ${commentText}`; // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –Ω–æ–º–µ—Ä –∏ —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
              commentsDiv.appendChild(commentElement);
            }
          }
        } else {
          commentsDiv.innerHTML = '–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤';
        }
      });
    }

      // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤
    function filterPosts() {
      const titleFilter = titleFilterInput.value.toLowerCase();
      const dateFilter = dateFilterInput.value.toLowerCase();
      const keywordsFilter = keywordsFilterInput.value.toLowerCase().split(' ');

      const postsRef = ref(database, 'posts');
      onValue(postsRef, (snapshot) => {
        if (snapshot.exists()) {
          postsContainer.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
          const posts = snapshot.val();
          for (const key in posts) {
            if (posts.hasOwnProperty(key)) {
              const post = posts[key];
              if (matchesFilter(post, titleFilter, dateFilter, keywordsFilter)) {
                addPostToView(post);
              }
            }
          }
        } else {
          postsContainer.innerHTML = '–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
        }
      });
    }

    submitPostButton.onclick = function() {
      const title = document.getElementById('postTitle').value;
      const content = document.getElementById('postContent').value;
      const imageInput = document.getElementById('postImage');
      const imageFile = imageInput.files[0];
      const eventId = document.getElementById('eventSelect').value; // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ

      if (!title || !content || !imageFile || !eventId) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.");
        return;
      }

      uploadPost(title, content, imageFile, eventId); // –ü–µ—Ä–µ–¥–∞–µ–º eventId
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø–æ—Å—Ç–∞ —Ñ–∏–ª—å—Ç—Ä–∞–º
    function matchesFilter(post, titleFilter, dateFilter, keywordsFilter) {
      const matchesTitle = post.title.toLowerCase().includes(titleFilter);
      const matchesDate = post.date.includes(dateFilter);
      const matchesKeywords = keywordsFilter.every(keyword => post.keywords.includes(keyword));

      return matchesTitle && matchesDate && matchesKeywords;
    }

    document.getElementById('openMapButton').onclick = function() {
      document.getElementById('mapModal').style.display = 'block';
      initializeMap(); // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã
    };

    document.getElementById('closeMapModal').onclick = function() {
      document.getElementById('mapModal').style.display = 'none';
    };

    window.onclick = function(event) {
      if (event.target === document.getElementById('mapModal')) {
        document.getElementById('mapModal').style.display = 'none';
      }
    };

    function initializeMap() {
      const map = L.map('map').setView([55.7558, 37.6173], 13); // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –∫–∞—Ä—Ç—ã

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
      }).addTo(map);

      // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          const userLat = position.coords.latitude;
          const userLng = position.coords.longitude;
          map.setView([userLat, userLng], 15);
          L.marker([userLat, userLng]).addTo(map)
            .bindPopup('–í—ã –∑–¥–µ—Å—å')
            .openPopup();
        });
      }

      // –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ç–æ–∫ –∏–∑ Firebase
      loadMarkers(map);
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–æ–∫ –∏–∑ Firebase
    function loadMarkers(map) {
      const markersRef = ref(database, 'markers'); // –ü—É—Ç—å –∫ –º–µ—Ç–∫–∞–º –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
      onValue(markersRef, (snapshot) => {
        if (snapshot.exists()) {
          map.eachLayer((layer) => {
            if (layer instanceof L.Marker) {
              map.removeLayer(layer); // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –º–∞—Ä–∫–µ—Ä—ã
            }
          });

          snapshot.forEach((childSnapshot) => {
            const markerData = childSnapshot.val();
            const marker = L.marker([markerData.latitude, markerData.longitude]).addTo(map);
            marker.bindPopup(`<strong>${markerData.title}</strong><br>${markerData.description}`);
          });
        } else {
          console.log("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Ç–æ–∫.");
        }
      }, {
        onlyOnce: true // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ—Ç–∫–∏ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
      });
    }

    const profileModal = document.getElementById('profileModal');
    const editProfileButton = document.getElementById('editProfileButton');
    const saveProfileButton = document.getElementById('saveProfileButton');
    const closeProfileModal = document.getElementById('closeProfileModal');

    const firstNameInput = document.getElementById('firstName');
    const lastNameInput = document.getElementById('lastName');
    const birthDateInput = document.getElementById('birthDate');

    const displayFirstName = document.getElementById('displayFirstName');
    const displayLastName = document.getElementById('displayLastName');
    const displayBirthDate = document.getElementById('displayBirthDate');

    // Open profile modal
    function openProfileModal() {
      profileModal.style.display = "block";
      loadUserProfile(); // Load user data when opening the modal
    }

    // Close profile modal
    closeProfileModal.onclick = function() {
      profileModal.style.display = "none";
    }

    // Close modal when clicking outside of it
    window.onclick = function(event) {
      if (event.target === profileModal) {
        profileModal.style.display = "none";
      }
    }

    // Load user profile data from Firebase
    function loadUserProfile() {
      const userId = auth.currentUser.uid; // Get current user ID
      const userRef = ref(database, 'users/' + userId);

      get(userRef).then((snapshot) => {
        if (snapshot.exists()) {
          const userData = snapshot.val();
          displayFirstName.innerText = userData.firstName || '';
          displayLastName.innerText = userData.lastName || '';
          displayBirthDate.innerText = userData.birthDate || '';
          firstNameInput.value = userData.firstName || '';
          lastNameInput.value = userData.lastName || '';
          birthDateInput.value = userData.birthDate || '';
        } else {
          console.log("User  data not found.");
        }
      }).catch((error) => {
        console.error("Error loading user data:", error);
      });
    }

    // Enable editing mode
    editProfileButton.onclick = function() {
      firstNameInput.style.display = "block";
      lastNameInput.style.display = "block";
      birthDateInput.style.display = "block";
      saveProfileButton.style.display = "block";
      editProfileButton.style.display = "none";
    }

    // Save user profile data
    saveProfileButton.onclick = function() {
      const userId = auth.currentUser.uid; // Get current user ID
      const userRef = ref(database, 'users/' + userId);

      const updatedUserData = {
        firstName: firstNameInput.value,
        lastName: lastNameInput.value,
        birthDate: birthDateInput.value
      };

      set(userRef, updatedUserData).then(() => {
        alert("–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!");
        loadUserProfile(); // Reload user data to reflect changes
        firstNameInput.style.display = "none";
        lastNameInput.style.display = "none";
        birthDateInput.style.display = "none";
        saveProfileButton.style.display = "none";
        editProfileButton.style.display = "block";
      }).catch((error) => {
        console.error("Error updating user data:", error);
      });
    }

    document.getElementById('profileButton').onclick = function() {
      openProfileModal();
    };

    document.getElementById('changePasswordButton').onclick = function() {
      document.getElementById('changePasswordModal').style.display = "block";
    };

    document.getElementById('closeChangePasswordModal').onclick = function() {
      document.getElementById('changePasswordModal').style.display = "none";
    };

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    window.onclick = function(event) {
      if (event.target === document.getElementById('changePasswordModal')) {
        document.getElementById('changePasswordModal').style.display = "none";
      }
    };

    document.getElementById('submitChangePassword').onclick = function() {
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      if (newPassword !== confirmPassword) {
        alert("–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç");
        return;
      }

      changePassword(currentPassword, newPassword);
    };

    function changePassword(currentPassword, newPassword) {
      const user = auth.currentUser ;

      if (user) {
        const credential = EmailAuthProvider.credential(user.email, currentPassword);

        user.reauthenticateWithCredential(credential).then(() => {
          user.updatePassword(newPassword).then(() => {
            alert("–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!");
            document.getElementById('changePasswordModal').style.display = "none";
          }).catch((error) => {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è:", error);
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å: " + error.message);
          });
        }).catch((error) => {
          console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:", error);
          alert("–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å.");
        });
      }
    }

    document.getElementById('changePasswordButton').onclick = function() {
      const user = auth.currentUser ;
      if (user) {
        document.getElementById('currentUser Email').innerText = user.email; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º email —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      }
      document.getElementById('changePasswordModal').style.display = "block";
    }

    window.onload = function() {
      const urlParams = new URLSearchParams(window.location.search);
      const bannerId = urlParams.get('bannerId');

      if (bannerId) {
        openEvent(bannerId); // –û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
      }

      loadPosts();
      titleFilterInput.addEventListener('input', filterPosts);
      dateFilterInput.addEventListener('input', filterPosts);
      keywordsFilterInput.addEventListener('input', filterPosts);
    }

  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f4f4f4;
      color: #333;
    }
    .post {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      background-color: #fff;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.7);
      padding-top: 60px;
    }

    .modal-content {
      background-color: #ffffff;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 90%;
      max-width: 500px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }

    h2 {
      color: #333;
    }

    input[type="text"],
    input[type="email"],
    input[type="password"],
    textarea,
    select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    button {
      background-color: #5cb85c;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    button:hover {
      background-color: #4cae4c;
    }

    .modal-footer {
      text-align: right;
    }

    #mapModal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.7);
      padding-top: 60px;
    }

    /* –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∏–ª–µ–π */
    .modal-content {
      background-color: #ffffff;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 90%;
      max-width: 500px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
  </style>
</head>
<body>

<button onclick="window.location.href='rulse.html'">–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º</button>

<h1>–ü–æ—Å—Ç—ã</h1>
<button id="loginButton">–í–æ–π—Ç–∏</button>
<button id="createPostButton">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</button>
<button id="openMapButton">–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É</button>
<button id="profileButton">–ü—Ä–æ—Ñ–∏–ª—å</button>
<button id="openMarkersButton">–û—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –º–µ—Ç–æ–∫</button>

<input type="text" id="titleFilter" placeholder="–§–∏–ª—å—Ç—Ä –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É">
<input type="text" id="dateFilter" placeholder="–§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ">
<input type="text" id="keywordsFilter" placeholder="–§–∏–ª—å—Ç—Ä –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º">

<div id="eventDetailsModal" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close" id="closeEventDetailsModal">&times;</span>
    <h2 id="eventTheme"></h2>
    <img id="eventImage" src="" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è" style="max-width: 100%; height: auto;">
    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <span id="eventDescription"></span></p>
    <p><strong>–ú–µ—Ç–∫–∞:</strong> <span id="eventMetka"></span></p>
    <button id="signUpButton">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
    <div id="qrcode"></div>
  </div>
</div>

<div id="markersModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeMarkersModal">&times;</span>
    <h2>–°–ø–∏—Å–æ–∫ –º–µ—Ç–æ–∫</h2>
    <ul id="markersList"></ul>
  </div>
</div>

<div id="profileModal" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close" id="closeProfileModal">&times;</span>
    <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
    <button id="changePasswordButton">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
    <input type="text" id="firstName" placeholder="–ò–º—è" required>
    <input type="text" id="lastName" placeholder="–§–∞–º–∏–ª–∏—è" required>
    <input type="date" id="birthDate" placeholder="–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è" required>
    <button id="editProfileButton">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
    <button id="saveProfileButton" style="display:none;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <div id="profileInfo">
      <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:</h3>
      <p><strong>–ò–º—è:</strong> <span id="displayFirstName"></span></p>
      <p><strong>–§–∞–º–∏–ª–∏—è:</strong> <span id="displayLastName"></span></p>
      <p><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> <span id="displayBirthDate"></span></p>
    </div>
  </div>
</div>

<div id="changePasswordModal" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close" id="closeChangePasswordModal">&times;</span>
    <h2>–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h2>
    <p><strong>Email:</strong> <span id="currentUser Email"></span></p>
    <input type="password" id="currentPassword" placeholder="–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å" required>
    <input type="password" id="newPassword" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required>
    <input type="password" id="confirmPassword" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required>
    <button id="submitChangePassword">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
  </div>
</div>

<div id="postsContainer"></div>



<div id="loginModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <h2>–í—Ö–æ–¥</h2>
    <input type="email" id="email" placeholder="Email" required>
    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
    <button id="submitLogin">–í–æ–π—Ç–∏</button>
  </div>
</div>



<div id="mapModal" style="display: none;">
  <div class="modal-content">
    <span class="close" id="closeMapModal">&times;</span>
    <h2>–ö–∞—Ä—Ç–∞</h2>
    <div id="map" style="height: 400px;"></div>
    <button id="ready_button">–ì–æ—Ç–æ–≤–æ</button>
  </div>
</div>



<div id="createPostModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeCreatePostModal">&times;</span>
    <h2>–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</h2>
    <select id="eventSelect">
      <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</option>
    </select>
    <input type=" text" id="postTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" required>
    <textarea id="postContent" placeholder="–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ" required></textarea>
    <input type="file" id="postImage" accept="image/*" required>
    <button id="submitPostButton">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</button>
  </div>
</div>

</body>
</html>
